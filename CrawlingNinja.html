<!doctype html>
<html>
<head>
<base href="http://newsmartwave.net/html/venedor/green/index.html">
<meta charset="utf-8">
<title>CrawlingNinja</title>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
<script type="text/javascript">
var urlList = {};
var productList = {};
var productNameList = {};
var currentIndex = 0;
var product = {};
function display(data)
{	
	
	if (data.query.results.results !== null)
	{
		var list = document.getElementById("links");
		var url = data.query.results.results.a;
		
		for(var i=0; i<url.length; i++)
		{
			var address = url[i].href;
			
			if ((address === undefined) || (address.charAt(0) === '#'))
			{
				 continue;	 
			}
				
			var anchor = document.createElement("a");
			anchor.setAttribute("href", address);
			if(undefined !== urlList[anchor.href])
			{
				continue;	
			}
			
			if ((anchor.protocol != "http:") && (anchor.protocol != "https:"))
			{
				continue;
			}
			if (anchor.hostname != "newsmartwave.net")
			{
				continue;
			}
			var startIndex = anchor.href.length - 4;
			if (anchor.href.substr(startIndex,4) == ".jpg")
			{
				continue;
			}
			
			
			//console.log(anchor.protocol);
			//console.log(anchor.hostname);
			
			urlList[anchor.href] = false;
			var listitem = document.createElement("li");
			listitem.textContent = anchor.href;
		
			list.appendChild(listitem);	
		}
	}
	
	/*for (var pname in urlList)
	{
		var listitem = document.createElement("li");
		listitem.textContent = pname;
	
		list.appendChild(listitem);	
	}*/
	
	var keys = Object.keys(urlList);
	if (currentIndex === keys.length - 1)
	{
		$(".status").hide();
		return;
	}
	crawlUrl(keys[currentIndex]);
	currentIndex++;
	
}

function crawlUrl(url) {
	
	var statusDiv = document.getElementById("url");
	statusDiv.textContent = url;
	url = encodeURI(url);
	
	$.ajax( {
		url:  "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20data.html.cssselect%20where%20url%3D%22" + url +"%22%20and%20css%3D%22a%22&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",
		dataType: "jsonp",
		async: false,
		jsonpCallback: 'display',
		contentType: "application/json",
	});
}

function displayProducts(products){
	if (products.query.results.results !== null)
	{
		var productBox = document.getElementById("right-bar")
		productList = products.query.results.results.img;
		
		//productNameList = products.query.results.results.a;
		for (i=0; i<productList.length; i++) 
		{
			
			var imageSource = productList[i].src;
			//console.log(imageSource);
			product[imageSource] = "false";
			
			
		}
		
		for ( imageSource in product)
		{
			var productWrapper = document.createElement("div");
			productWrapper.classList.add("product-image-conatiner");
			productBox.appendChild(productWrapper);
			var productItem =	document.createElement("img");
			productItem.setAttribute("src",imageSource);
			productItem.classList.add("product-image");
			productWrapper.appendChild(productItem);
				
		}
	}
}

function crawlProducts() {
	
	$.ajax({
		url:"https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20data.html.cssselect%20where%20url%3D%22http%3A%2F%2Fnewsmartwave.net%2Fhtml%2Fvenedor%2Fgreen%2Findex.html%22%20and%20css%3D%22.item-hover%20.item-image%2C.item-hover%20.item-name%20a%22&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",
		dataType: "jsonp",
		async: false,
		jsonpCallback: 'displayProducts',
		contentType: "application/json"
	});
}

window.addEventListener("load",initialise);
function initialise() {
crawlUrl("http://newsmartwave.net/html/venedor/green/index.html");
crawlProducts();
}



</script>

<style>

@media screen and (minwidth: 1243px)
{
	.bar{
		width: 30%;
	}
	.status {
		width: 68%
	}
	.right-bar {
		width: 68%;
	}
	
}

body {
	font-family: "Open Sans";
	font-size: 14px;
}
.bar {
	float: left;
	width: 48%;
	border: 1px solid #ccc;
	word-wrap: break-word;
}
.status {
	position: fixed;
	top: 10px;
	right: 10px;
	width: 47%;
	border: 1px solid #ccc;
	background-color: #E5E3E3;
	border-radius: 3px;
	padding: 15px 15px;
	
}

.container:after {
	content: '';
	clear: both;
	display: block;
}
	

#right-bar {
	
	float: right;
	width: 50%;
	border: 1px solid #ccc;
	margin-top: 100px;
}

.product-image-conatiner {
	float: left;
	width: 200px;
	height: 200px;
	padding: 10px;
}

.product-image {
	width: inherit;
	height: inherit;
}
</style>
</head>

<body>

<div class="container">
	<div class="bar">
        <ul id="links">
        </ul>
	</div>
    <div class="status">
         Currently crawling:
        <div id="url"></div>
    </div>
    <div id="right-bar">
    </div>
</div>
<script>

//$.get("http://localhost/CrawlingNinja/test.txt", function(data) {
	//alert(data);
//});

</script>

<!--<script src='https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20data.html.cssselect%20where%20url%3D%22http%3A%2F%2Fnewsmartwave.net%2Fhtml%2Fvenedor%2Fgreen%2Findex.html%22%20and%20css%3D%22a%22&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=display'></script>-->

</body>
</html>




